#lec 3 SPOC Discussion

## 第三讲 启动、中断、异常和系统调用-思考题

## 3.1 BIOS
 1. 比较UEFI和BIOS的区别。
 ```
 > UEFI，是一种详细描述类型接口的标准。这种接口用于操作系统自动从预启动的操作环境，加载到一种操作系统上。与BIOS显著不同的是，UEFI是用模块化、C语言风格的参数堆栈传递方式、动态链接的形式构建系统，它比BIOS更易于实现，容错和纠错特性也更强，从而缩短了系统研发的时间。更加重要的是，它运行于32位或64位模式，突破了传统16位代码的寻址能力，达到处理器的最大寻址，此举克服了BIOS代码运行缓慢的弊端。
 ```
 
 1. 描述PXE的大致启动流程。
 ```
 > 客户端个人电脑开机后， 在 TCP/IP Bootrom 获得控制权之前先做自我测试。
 Bootprom 送出 BOOTP/DHCP 要求以取得 IP。
 如果服务器收到个人电脑所送出的要求， 就会送回 BOOTP/DHCP 回应，内容包括客户端的 IP 地址， 预设网关，及开机映像文件。否则，服务器会忽略这个要求。
 Bootprom 由 TFTP 通讯协议从服务器下载开机映像文件。
 个人电脑通过这个开机映像文件开机， 这个开机文件可以只是单纯的开机程式也可以是操作系统。
 开机映像文件将包含 kernel loader 及压缩过的 kernel，此 kernel 将支持NTFS root系统。
 远程客户端根据下载的文件启动机器。

 ```

## 3.2 系统启动流程
 1. 了解NTLDR的启动流程。
 ```
 > NTLDR一般存放于C盘根目录下，是一个具有隐藏和只读属性的系统文件。它的主要职责是解析Boot.ini文件。
 其启动过程包括：预引导、引导、加载内核。
 ```
 
 1. 了解GRUB的启动流程。
 ```
 > 当系统加电后，固化在BIOS中的程序首先对系统硬件进行自检，自检通过后，就加载启动磁盘上的MBR，并将控制权交给MBR中的程序(stage1)，stage1执行，判断自己是否GRUB，如果是且配置了stage1_5，则加载stage1_5，否则就转去加载启动扇区，接着，stage2被加载并执行，由stage2借助stage1_5驱动文件系统，并查找grub.conf，显示启动菜单供用户选择，然后根据用户的选择或默认配置加载操作系统内核，并将控制权交给操作系统内核，由内核完成操作系统的启动。
```

 1. 比较NTLDR和GRUB的功能有差异。
 ```
 > ntldr功能很少，只能引导win，只能装在硬盘；
 grub是第三方操作系统引导器，可以引导硬盘，光盘，网络，U盘，winxp，winpe，win7，linux，dos等
 ```
 
 1. 了解u-boot的功能。
 ```
 > 1.系统引导支持NFS挂载、RAMDISK(压缩或非压缩)形式的根文件系统；支持NFS挂载、从FLASH中引导压缩或非压缩系统内核；
 2.基本辅助功能强大的操作系统接口功能；可灵活设置、传递多个关键参数给操作系统，适合系统在不同开发阶段的调试要求与产品发布，尤以Linux支持最为强劲；支持目标板环境参数多种存储方式，如FLASH、NVRAM、EEPROM；
 3.CRC32校验可校验FLASH中内核、RAMDISK镜像文件是否完好；
 4.设备驱动串口、SDRAM、FLASH、以太网、LCD、NVRAM、EEPROM、键盘、USB、PCMCIA、PCI、RTC等驱动支持；
 5.上电自检功能SDRAM、FLASH大小自动检测；SDRAM故障检测；CPU型号；
 6.特殊功能XIP内核引导；
```

## 3.3 中断、异常和系统调用比较
 1. 举例说明Linux中有哪些中断，哪些异常？
 1. Linux的系统调用有哪些？大致的功能分类有哪些？  (w2l1)

```
  + 采分点：说明了Linux的大致数量（上百个），说明了Linux系统调用的主要分类（文件操作，进程管理，内存管理等）
  - 答案没有涉及上述两个要点；（0分）
  - 答案对上述两个要点中的某一个要点进行了正确阐述（1分）
  - 答案对上述两个要点进行了正确阐述（2分）
  - 答案除了对上述两个要点都进行了正确阐述外，还进行了扩展和更丰富的说明（3分）
 
 >		大约有200多个系统调用。
 >		大致分类为：进程控制、文件系统控制、系统控制、内存管理、网络管理、socket控制、用户管理、进程间通信。
 
 ```
 1. 以ucore lab8的answer为例，uCore的系统调用有哪些？大致的功能分类有哪些？(w2l1)
 
 ```
  + 采分点：说明了ucore的大致数量（二十几个），说明了ucore系统调用的主要分类（文件操作，进程管理，内存管理等）
  - 答案没有涉及上述两个要点；（0分）
  - 答案对上述两个要点中的某一个要点进行了正确阐述（1分）
  - 答案对上述两个要点进行了正确阐述（2分）
  - 答案除了对上述两个要点都进行了正确阐述外，还进行了扩展和更丰富的说明（3分）
  
  >	大约为22个。
  >	分类如下：
  >	1. 进程管理：如sys_fork、sys_exit、sys_getpid; 
  >	2. 系统控制：如sys_gettime; 
  >	3. 文件操作：如sys_read、sys_write
 
 ```
## 3.4 linux系统调用分析
 1. 通过分析[lab1_ex0](https://github.com/chyyuu/ucore_lab/blob/master/related_info/lab1/lab1-ex0.md)了解Linux应用的系统调用编写和含义。(w2l1)

 ```
  + 采分点：说明了objdump，nm，file的大致用途，说明了系统调用的具体含义
  - 答案没有涉及上述两个要点；（0分）
  - 答案对上述两个要点中的某一个要点进行了正确阐述（1分）
  - 答案对上述两个要点进行了正确阐述（2分）
  - 答案除了对上述两个要点都进行了正确阐述外，还进行了扩展和更丰富的说明（3分）
 
 >		objdump:显示文件信息，对不同的参数进行不同操作，如-d为进行反汇编得到该程序的汇编代码；
 >		nm:列出文件的符号信息，如a为AF_INET
 >		file:检测文件类型、版本等，用file命令对该文件进行分析可得：文件类型为64位的可执行文件。
 >		系统调用的具体含义：系统调用为上层提供不同的服务，对不同的系统调用，需要对参数进行设置。
 >		如%eax设为SYS_write（输出），%ebx设为STDOUT（屏幕输出），设为%ecx设为输出字符的地址，%edx设为输出的长度（12），然后用int 0x80中断进行系统调用。
 
 ```
 1. 通过调试[lab1_ex1](https://github.com/chyyuu/ucore_lab/blob/master/related_info/lab1/lab1-ex1.md)了解Linux应用的系统调用执行过程。(w2l1)
 

 ```
  + 采分点：说明了strace的大致用途，说明了系统调用的具体执行过程（包括应用，CPU硬件，操作系统的执行过程）
  - 答案没有涉及上述两个要点；（0分）
  - 答案对上述两个要点中的某一个要点进行了正确阐述（1分）
  - 答案对上述两个要点进行了正确阐述（2分）
  - 答案除了对上述两个要点都进行了正确阐述外，还进行了扩展和更丰富的说明（3分）
  
  
 >		strace的大致用途：用来跟踪进程执行时的系统调用和所接收的信号，包括参数、返回值、时间。
 >		根据不同的参数会执行不同的功能，如-c表示为统计每一系统调用的执行时间、出错次数。
 >		具体执行过程：进程是不能访问内核的。它不能访问内核所占内存空间也不能调用内核函数。CPU硬件决定了这些。系统调用是这些规则的一个例外。
 >		其原理是进程先用适当的值填充寄存器，然后调用一个特殊的指令，这个指令会跳到一个事先定义的内核中的一个位置
 >		这个由中断0x80实现。硬件知道一旦你跳到这个位置，你就不是在限制模式下运行的用户，而是作为操作系统的内核来运作。
 >		进程可以跳转到的内核位置叫做sysem_call。这个过程检查系统调用号，这个号码告诉内核进程请求哪种服务。
 >		然后，它查看系统调用表(sys_call_table)找到所调用的内核函数入口地址。接着，就调用函数，等返回后，做一些系统检查，最后返回到进程。

 ```
## 3.5 ucore系统调用分析
 1. ucore的系统调用中参数传递代码分析。
 1. ucore的系统调用中返回结果的传递代码分析。
 1. 以ucore lab8的answer为例，分析ucore 应用的系统调用编写和含义。
 1. 以ucore lab8的answer为例，尝试修改并运行代码，分析ucore应用的系统调用执行过程。
 
## 3.6 请分析函数调用和系统调用的区别
 1. 请从代码编写和执行过程来说明。
   1. 说明`int`、`iret`、`call`和`ret`的指令准确功能
 
